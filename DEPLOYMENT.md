# Production Deployment Guide

## Overview

This guide covers the deployment of the Tandon Legal Operations Dashboard to a production environment.

## Pre-Deployment Checklist

- [ ] All tests passing (pytest coverage > 80%)
- [ ] Code review approved
- [ ] Security audit completed
- [ ] Environment variables configured
- [ ] Database migrations tested
- [ ] SSL certificate installed
- [ ] Backup strategy implemented
- [ ] Monitoring and alerts configured
- [ ] Load testing completed
- [ ] Disaster recovery plan documented

## Deployment to Vercel

### Prerequisites

1. Vercel account created
2. GitHub repository connected
3. Domain configured in Vercel
4. SSL certificate auto-generated by Vercel

### Environment Variables on Vercel

1. Go to Vercel Dashboard > Project Settings > Environment Variables
2. Add the following variables:
   - FLASK_ENV=production
   - DATABASE_URL (PostgreSQL connection string)
   - JWT_SECRET_KEY
   - FLASK_SECRET_KEY
   - All variables from .env.example

### Deployment Steps

1. Push code to main branch: `git push origin main`
2. Vercel automatically deploys on push
3. Monitor deployment in Vercel Dashboard
4. Verify deployment at https://your-domain.com

### Verify Deployment

- Navigate to your domain
- Test login functionality
- Test dashboard pages
- Verify SSL certificate is valid
- Check browser console for errors

## Docker Deployment

### Build Docker Image

```bash
docker build -t tandon-legal-dashboard:latest .
```

### Push to Docker Registry

```bash
# Tag image
docker tag tandon-legal-dashboard:latest your-registry/tandon-legal-dashboard:latest

# Push to registry
docker push your-registry/tandon-legal-dashboard:latest
```

### Run with Docker Compose

```bash
docker-compose up -d
```

### Verify Docker Deployment

```bash
# Check running containers
docker-compose ps

# View logs
docker-compose logs -f web

# Test API
curl http://localhost:8000/api/health
```

## Database Setup

### PostgreSQL Installation

```bash
# Install PostgreSQL
sudo apt-get install postgresql postgresql-contrib

# Start PostgreSQL service
sudo systemctl start postgresql
```

### Create Database and User

```sql
CREATE DATABASE tandon_legal_db;
CREATE USER tandon_user WITH PASSWORD 'secure-password';
ALTER ROLE tandon_user SET client_encoding TO 'utf8';
ALTER ROLE tandon_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE tandon_user SET default_transaction_deferrable TO on;
GRANT ALL PRIVILEGES ON DATABASE tandon_legal_db TO tandon_user;
```

### Run Migrations

```bash
flask db upgrade
```

## Backend Setup on Server

### Install Python and Dependencies

```bash
# Install Python 3.11
sudo apt-get install python3.11 python3.11-venv

# Create virtual environment
python3.11 -m venv venv

# Activate virtual environment
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

### Configure Environment

```bash
# Copy environment template
cp .env.example .env

# Edit .env with production values
nano .env
```

### Run Application

```bash
# Using Gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 app:app

# Using systemd service (recommended)
sudo nano /etc/systemd/system/tandon-legal.service
```

### Systemd Service Configuration

```ini
[Unit]
Description=Tandon Legal Dashboard
After=network.target

[Service]
User=www-data
WorkingDirectory=/var/www/tandon-legal
Environment="PATH=/var/www/tandon-legal/venv/bin"
ExecStart=/var/www/tandon-legal/venv/bin/gunicorn -w 4 -b 0.0.0.0:8000 app:app
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### Enable and Start Service

```bash
sudo systemctl enable tandon-legal
sudo systemctl start tandon-legal
sudo systemctl status tandon-legal
```

## Nginx Configuration

```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## SSL Certificate Setup

### Using Let's Encrypt with Certbot

```bash
# Install Certbot
sudo apt-get install certbot python3-certbot-nginx

# Generate certificate
sudo certbot certonly --nginx -d your-domain.com

# Auto-renewal setup
sudo systemctl enable certbot.timer
```

## Monitoring & Logging

### Application Logging

- Logs stored in `/var/log/tandon-legal/`
- Rotation: Daily, keep 30 days
- Level: INFO in production

### Health Checks

```bash
# Create health check endpoint
curl https://your-domain.com/api/health
```

### Monitoring Tools

- Prometheus for metrics
- Grafana for dashboards
- ELK Stack for logging
- Sentry for error tracking

## Backup Strategy

### Database Backups

```bash
# Daily backup
0 2 * * * pg_dump tandon_legal_db > /backups/tandon_$(date +\%Y\%m\%d).sql

# Compress backup
gzip /backups/tandon_*.sql
```

### Backup Retention

- Daily: 7 days
- Weekly: 4 weeks
- Monthly: 12 months

## Disaster Recovery

### Restore from Backup

```bash
# Restore database
psql tandon_legal_db < backup.sql

# Restore application files
tar -xzf app-backup.tar.gz
```

## Post-Deployment

1. Monitor error logs
2. Check API response times
3. Verify all features working
4. Test with real data
5. Load testing
6. Security scanning
7. User acceptance testing

## Rollback Procedure

1. Identify issue
2. Revert to previous commit: `git revert <commit-hash>`
3. Redeploy to Vercel
4. Verify rollback successful
5. Post-mortem analysis

## Support & Troubleshooting

For deployment issues, contact: deployment@tandonassociates.com
